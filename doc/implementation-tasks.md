# チー牛農場 - 実装タスクリスト

## 概要

このドキュメントは、チー牛農場の実装に必要なタスクを順序立てて記載しています。
依存関係を考慮し、Phase 1 (MVP) → Phase 2 → Phase 3 の順で実装します。

---

## Phase 0: プロジェクト初期設定

### 0.1 開発環境セットアップ

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 0.1.1 | Next.js プロジェクト作成 | `npx create-next-app@latest` でApp Router有効化 | - |
| 0.1.2 | TypeScript設定 | strict mode有効化、パス設定 | 0.1.1 |
| 0.1.3 | Tailwind CSS設定 | カスタムカラーパレット追加 | 0.1.1 |
| 0.1.4 | ESLint/Prettier設定 | コードスタイル統一 | 0.1.1 |
| 0.1.5 | Git初期化 | .gitignore設定、初回コミット | 0.1.1 |

### 0.2 Supabaseセットアップ

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 0.2.1 | Supabaseプロジェクト作成 | ダッシュボードからプロジェクト作成 | - |
| 0.2.2 | 環境変数設定 | `.env.local`にSupabaseキー設定 | 0.2.1 |
| 0.2.3 | Supabaseクライアント設定 | `lib/supabase/client.ts`, `server.ts`作成 | 0.2.2 |
| 0.2.4 | 型定義生成 | `supabase gen types` で型生成 | 0.2.1 |

### 0.3 UIライブラリセットアップ

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 0.3.1 | shadcn/ui初期化 | `npx shadcn-ui@latest init` | 0.1.3 |
| 0.3.2 | 基本コンポーネント追加 | Button, Input, Card, Dialog など | 0.3.1 |
| 0.3.3 | カスタムテーマ設定 | パステルカラーの適用 | 0.3.1 |
| 0.3.4 | フォント設定 | Noto Sans JP の読み込み | 0.1.3 |

---

## Phase 1: MVP（必須機能）

### 1.1 データベース構築

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.1.1 | profilesテーブル作成 | ユーザープロフィール | 0.2.1 |
| 1.1.2 | postsテーブル作成 | 投稿データ | 1.1.1 |
| 1.1.3 | commentsテーブル作成 | コメントデータ | 1.1.2 |
| 1.1.4 | reactionsテーブル作成 | リアクションデータ | 1.1.2 |
| 1.1.5 | followsテーブル作成 | フォロー関係 | 1.1.1 |
| 1.1.6 | RLSポリシー設定 | 全テーブルのセキュリティ設定 | 1.1.1-1.1.5 |
| 1.1.7 | 型定義更新 | スキーマ変更後の型再生成 | 1.1.6 |

### 1.2 認証機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.2.1 | 認証レイアウト作成 | `app/(auth)/layout.tsx` | 0.3.2 |
| 1.2.2 | 登録ページUI | `app/(auth)/register/page.tsx` | 1.2.1 |
| 1.2.3 | ログインページUI | `app/(auth)/login/page.tsx` | 1.2.1 |
| 1.2.4 | 登録API実装 | メール/パスワード登録処理 | 1.1.1, 0.2.3 |
| 1.2.5 | ログインAPI実装 | ログイン処理・セッション管理 | 0.2.3 |
| 1.2.6 | マジックリンク実装 | パスワードレスログイン | 0.2.3 |
| 1.2.7 | ログアウト実装 | セッション終了処理 | 1.2.5 |
| 1.2.8 | 認証ミドルウェア | 未認証ユーザーのリダイレクト | 1.2.5 |
| 1.2.9 | useAuthフック作成 | 認証状態管理フック | 1.2.5 |

### 1.3 プロフィール機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.3.1 | 初期設定ページ | 登録後の趣味タグ・自己紹介設定 | 1.2.4 |
| 1.3.2 | プロフィール表示ページ | `app/(main)/profile/[id]/page.tsx` | 1.1.1 |
| 1.3.3 | プロフィール編集ページ | `app/(main)/settings/profile/page.tsx` | 1.3.2 |
| 1.3.4 | アバターアップロード | Supabase Storageへの画像保存 | 0.2.3, 1.3.3 |
| 1.3.5 | 趣味タグコンポーネント | タグ選択・表示UI | 0.3.2 |
| 1.3.6 | プライバシー設定ページ | デフォルト匿名設定など | 1.3.3 |

### 1.4 共通レイアウト

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.4.1 | メインレイアウト | `app/(main)/layout.tsx` | 1.2.8 |
| 1.4.2 | ヘッダーコンポーネント | ナビゲーション、ユーザーメニュー | 1.4.1, 1.2.9 |
| 1.4.3 | サイドバーコンポーネント | 趣味タグフィルター、メニュー | 1.4.1 |
| 1.4.4 | モバイルナビゲーション | ボトムナビゲーション | 1.4.1 |
| 1.4.5 | ローディング状態 | スケルトンUI | 0.3.2 |
| 1.4.6 | エラーバウンダリ | エラー表示コンポーネント | 0.3.2 |

### 1.5 投稿機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.5.1 | 投稿作成フォーム | テキスト入力、タグ選択、匿名オプション | 1.3.5, 0.3.2 |
| 1.5.2 | 画像アップロード | 投稿への画像添付 | 0.2.3 |
| 1.5.3 | 投稿API (CREATE) | 投稿作成エンドポイント | 1.1.2 |
| 1.5.4 | 投稿API (READ) | 投稿取得エンドポイント | 1.1.2 |
| 1.5.5 | 投稿API (UPDATE) | 投稿編集エンドポイント | 1.1.2 |
| 1.5.6 | 投稿API (DELETE) | 投稿削除エンドポイント | 1.1.2 |
| 1.5.7 | 投稿カードコンポーネント | 投稿表示UI | 0.3.2 |
| 1.5.8 | 投稿詳細モーダル | 投稿の詳細表示 | 1.5.7 |
| 1.5.9 | usePostsフック | 投稿データ取得・キャッシュ | 1.5.4 |

### 1.6 タイムライン機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.6.1 | フィードページ | `app/(main)/feed/page.tsx` | 1.4.1 |
| 1.6.2 | タイムラインAPI | フォロー中ユーザーの投稿取得 | 1.1.2, 1.1.5 |
| 1.6.3 | タイムラインコンポーネント | 投稿一覧表示 | 1.5.7 |
| 1.6.4 | 無限スクロール | ページネーション実装 | 1.6.3 |
| 1.6.5 | 趣味タグフィルター | タグによる絞り込み | 1.6.3, 1.3.5 |
| 1.6.6 | プルトゥリフレッシュ | 最新投稿の取得 | 1.6.3 |

### 1.7 リアクション機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.7.1 | リアクションボタン | いいね/共感/同感/応援 | 0.3.2 |
| 1.7.2 | リアクションAPI | リアクション追加・削除 | 1.1.4 |
| 1.7.3 | リアクション数表示 | レンジ表示（10〜50など） | 1.7.2 |
| 1.7.4 | リアクションアニメーション | ボタン押下時のフィードバック | 1.7.1 |

### 1.8 コメント機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.8.1 | コメントフォーム | テキスト入力、匿名オプション | 0.3.2 |
| 1.8.2 | コメント一覧 | コメント表示UI | 0.3.2 |
| 1.8.3 | コメントAPI (CREATE) | コメント投稿 | 1.1.3 |
| 1.8.4 | コメントAPI (READ) | コメント取得 | 1.1.3 |
| 1.8.5 | コメントAPI (DELETE) | コメント削除 | 1.1.3 |

### 1.9 フォロー機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.9.1 | フォローボタン | フォロー/フォロー解除 | 0.3.2 |
| 1.9.2 | フォローAPI | フォロー関係の操作 | 1.1.5 |
| 1.9.3 | フォロー一覧ページ | フォロー中ユーザー一覧 | 1.9.2 |
| 1.9.4 | フォロワー一覧ページ | フォロワー一覧 | 1.9.2 |
| 1.9.5 | useFollowフック | フォロー状態管理 | 1.9.2 |

### 1.10 検索避け対策

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.10.1 | robots.txt | クローラーブロック設定 | 0.1.1 |
| 1.10.2 | noindexメタタグ | 全ページにメタタグ追加 | 1.4.1 |
| 1.10.3 | X-Robots-Tagヘッダー | APIレスポンスヘッダー設定 | 0.1.1 |

### 1.11 PWA対応

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 1.11.1 | next-pwa設定 | Service Worker設定 | 0.1.1 |
| 1.11.2 | manifest.json | アプリマニフェスト作成 | 1.11.1 |
| 1.11.3 | アプリアイコン | 各サイズのアイコン作成 | 1.11.2 |
| 1.11.4 | オフライン対応 | 基本的なオフライン表示 | 1.11.1 |

---

## Phase 2: コミュニティ機能

### 2.1 データベース拡張

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 2.1.1 | communitiesテーブル作成 | コミュニティ情報 | Phase 1完了 |
| 2.1.2 | community_membersテーブル作成 | メンバー関係 | 2.1.1 |
| 2.1.3 | RLSポリシー追加 | コミュニティ関連のセキュリティ | 2.1.1, 2.1.2 |
| 2.1.4 | 型定義更新 | スキーマ変更後の型再生成 | 2.1.3 |

### 2.2 コミュニティ機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 2.2.1 | コミュニティ一覧ページ | `app/(main)/communities/page.tsx` | 2.1.1 |
| 2.2.2 | コミュニティ詳細ページ | `app/(main)/communities/[id]/page.tsx` | 2.2.1 |
| 2.2.3 | コミュニティ作成フォーム | 名前、説明、公開設定 | 2.1.1 |
| 2.2.4 | コミュニティAPI (CRUD) | 作成・取得・更新・削除 | 2.1.1 |
| 2.2.5 | メンバー管理API | 参加・退会・権限変更 | 2.1.2 |
| 2.2.6 | コミュニティ投稿 | コミュニティ限定投稿機能 | 2.2.2, 1.5.3 |
| 2.2.7 | コミュニティ検索 | 趣味タグによる検索 | 2.2.1 |
| 2.2.8 | モデレーター機能 | 投稿削除、メンバー管理 | 2.2.5 |

### 2.3 マッチング機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 2.3.1 | 類似度計算ロジック | 趣味タグベースのスコア計算 | 1.3.5 |
| 2.3.2 | おすすめユーザーAPI | 類似ユーザーの取得 | 2.3.1 |
| 2.3.3 | おすすめ表示コンポーネント | サイドバーへの表示 | 2.3.2 |

---

## Phase 3: イベント機能

### 3.1 データベース拡張

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 3.1.1 | eventsテーブル作成 | イベント情報 | Phase 2完了 |
| 3.1.2 | event_participantsテーブル作成 | 参加者情報 | 3.1.1 |
| 3.1.3 | RLSポリシー追加 | イベント関連のセキュリティ | 3.1.1, 3.1.2 |
| 3.1.4 | 型定義更新 | スキーマ変更後の型再生成 | 3.1.3 |

### 3.2 イベント機能

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 3.2.1 | イベント一覧ページ | `app/(main)/events/page.tsx` | 3.1.1 |
| 3.2.2 | イベント詳細ページ | `app/(main)/events/[id]/page.tsx` | 3.2.1 |
| 3.2.3 | イベント作成フォーム | タイトル、日時、場所、定員 | 3.1.1 |
| 3.2.4 | イベントAPI (CRUD) | 作成・取得・更新・削除 | 3.1.1 |
| 3.2.5 | 参加申込API | 参加・キャンセル | 3.1.2 |
| 3.2.6 | イベントカレンダー | カレンダー形式での表示 | 3.2.1 |
| 3.2.7 | イベントレポート | イベント後の投稿機能 | 3.2.2, 1.5.3 |

---

## Phase 4: 最適化・改善

### 4.1 パフォーマンス最適化

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 4.1.1 | React Query導入 | データフェッチ・キャッシュ最適化 | Phase 1完了 |
| 4.1.2 | バンドル最適化 | コード分割、Tree Shaking | Phase 1完了 |
| 4.1.3 | 画像最適化 | WebP変換、遅延読み込み | Phase 1完了 |
| 4.1.4 | Lighthouse監査 | パフォーマンススコア改善 | 4.1.1-4.1.3 |

### 4.2 セキュリティ強化

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 4.2.1 | レート制限実装 | APIエンドポイントの保護 | Phase 1完了 |
| 4.2.2 | 入力バリデーション | Zodによるスキーマ検証 | Phase 1完了 |
| 4.2.3 | CSRFトークン | フォーム保護 | Phase 1完了 |
| 4.2.4 | コンテンツモデレーション | 不適切投稿の検出 | Phase 1完了 |

### 4.3 アクセシビリティ改善

| # | タスク | 説明 | 依存 |
|---|--------|------|------|
| 4.3.1 | ARIAラベル追加 | 全インタラクティブ要素 | Phase 1完了 |
| 4.3.2 | キーボードナビゲーション | タブ操作対応 | Phase 1完了 |
| 4.3.3 | スクリーンリーダーテスト | 読み上げ確認 | 4.3.1, 4.3.2 |

---

## タスク進捗チェックリスト

### Phase 0: プロジェクト初期設定
- [ ] 0.1.1 Next.js プロジェクト作成
- [ ] 0.1.2 TypeScript設定
- [ ] 0.1.3 Tailwind CSS設定
- [ ] 0.1.4 ESLint/Prettier設定
- [ ] 0.1.5 Git初期化
- [ ] 0.2.1 Supabaseプロジェクト作成
- [ ] 0.2.2 環境変数設定
- [ ] 0.2.3 Supabaseクライアント設定
- [ ] 0.2.4 型定義生成
- [ ] 0.3.1 shadcn/ui初期化
- [ ] 0.3.2 基本コンポーネント追加
- [ ] 0.3.3 カスタムテーマ設定
- [ ] 0.3.4 フォント設定

### Phase 1: MVP
- [ ] 1.1.1 - 1.1.7 データベース構築
- [ ] 1.2.1 - 1.2.9 認証機能
- [ ] 1.3.1 - 1.3.6 プロフィール機能
- [ ] 1.4.1 - 1.4.6 共通レイアウト
- [ ] 1.5.1 - 1.5.9 投稿機能
- [ ] 1.6.1 - 1.6.6 タイムライン機能
- [ ] 1.7.1 - 1.7.4 リアクション機能
- [ ] 1.8.1 - 1.8.5 コメント機能
- [ ] 1.9.1 - 1.9.5 フォロー機能
- [ ] 1.10.1 - 1.10.3 検索避け対策
- [ ] 1.11.1 - 1.11.4 PWA対応

### Phase 2: コミュニティ
- [ ] 2.1.1 - 2.1.4 データベース拡張
- [ ] 2.2.1 - 2.2.8 コミュニティ機能
- [ ] 2.3.1 - 2.3.3 マッチング機能

### Phase 3: イベント
- [ ] 3.1.1 - 3.1.4 データベース拡張
- [ ] 3.2.1 - 3.2.7 イベント機能

### Phase 4: 最適化
- [ ] 4.1.1 - 4.1.4 パフォーマンス最適化
- [ ] 4.2.1 - 4.2.4 セキュリティ強化
- [ ] 4.3.1 - 4.3.3 アクセシビリティ改善

---

## 実装の注意事項

### 優先順位
1. **Phase 0** → **Phase 1** は必ず順番に実装
2. Phase 1内では、データベース → 認証 → 共通レイアウト → 機能の順
3. Phase 2, 3は独立して実装可能（Phase 1完了後）

### 依存関係の原則
- データベーススキーマは機能実装前に完了させる
- RLSポリシーはテーブル作成直後に設定
- 認証は他の機能より先に実装
- 共通コンポーネントは個別機能より先に実装

### テスト戦略
- 各機能完了後にマニュアルテスト実施
- クリティカルな機能（認証、投稿）は自動テスト検討
- デバイス・ブラウザ互換性テストはPhase 1完了後

---

## 更新履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| 1.0 | 2026-01-16 | 初版作成 |
